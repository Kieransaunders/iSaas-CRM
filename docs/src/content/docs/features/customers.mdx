---
title: Customer Management
description: Managing your client companies in your client portal
---

Customers represent the **client companies** that access your **client portal**. Each customer gets their own secure, isolated space within your platform.

## What is a Customer?

A Customer is a client company that uses your client portal. Each Customer:
- Gets their own isolated data space (other clients can't see their data)
- Can have multiple users (employees) who log into your portal
- Is managed by your Staff members
- Belongs to your Organization (agency)

## Data Model

```typescript
customers: defineTable({
  orgId: v.id('organizations'),
  name: v.string(),
  slug: v.string(),        // Unique within org
  settings: v.object({
    // Customer-specific settings
  }),
  createdAt: v.number(),
})
  .index('by_org', ['orgId'])
  .index('by_org_slug', ['orgId', 'slug']);
```

## Creating a Customer

```typescript
export const create = mutation({
  args: {
    name: v.string(),
    slug: v.string(),
  },
  handler: async (ctx, args) => {
    const org = await getCurrentOrg(ctx);
    
    // Check customer limit
    const existingCount = await ctx.db
      .query('customers')
      .withIndex('by_org', q => q.eq('orgId', org._id))
      .collect();
      
    if (existingCount.length >= org.maxCustomers) {
      throw new Error('Customer limit reached');
    }
    
    return await ctx.db.insert('customers', {
      orgId: org._id,
      name: args.name,
      slug: args.slug,
      createdAt: Date.now(),
    });
  },
});
```

## Assigning Staff to Customers

Staff members can be assigned to specific customers:

```typescript
staffCustomerAssignments: defineTable({
  staffUserId: v.id('users'),
  customerId: v.id('customers'),
  orgId: v.id('organizations'),
  assignedAt: v.number(),
})
  .index('by_staff', ['staffUserId'])
  .index('by_customer', ['customerId']);
```

## Customer Portal

Customers have a self-service portal where they can:
- View their data
- Manage their users
- Update their settings

Access is restricted based on the Client role.
